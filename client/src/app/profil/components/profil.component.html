<div class="min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50">
  <!-- HEADER -->
  <div class="bg-gradient-to-r from-amber-600 via-orange-600 to-amber-700 text-white py-12 sm:py-16 md:py-20 mb-8 sm:mb-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
        <div>
          <!--  Dynamic title based on role -->
          <h1 class="text-3xl sm:text-4xl md:text-5xl font-serif font-bold mb-2 sm:mb-3">
            {{ isAdmin() ? 'Admin Profile' : 'Your Profile' }}
          </h1>
          <p class="text-base sm:text-lg text-amber-100">
            {{ isAdmin() ? 'Manage your admin account settings' : 'Manage your account and view order history' }}
          </p>
        </div>

        <!--  Show order count only for regular users -->
        @if (!isAdmin()) {
          <div class="flex gap-4 sm:gap-6">
            <div class="text-center">
              <div class="text-2xl sm:text-3xl font-bold">{{ orders()?.length || 0 }}</div>
              <div class="text-xs sm:text-sm text-amber-200">Orders</div>
            </div>
          </div>
        }
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12 sm:pb-16">
    <!--  Dynamic grid: full width for admin, 2/3 + 1/3 for users -->
    <div [class]="isAdmin() ? 'max-w-3xl mx-auto' : 'grid grid-cols-1 lg:grid-cols-3 gap-6 sm:gap-8'">

      <!-- PROFILE FORM -->
      <div [class]="isAdmin() ? 'w-full' : 'lg:col-span-2'">
        <div class="bg-white rounded-lg shadow-md overflow-hidden">

          <!-- Profile Header -->
          <div class="px-4 sm:px-6 py-4 border-b border-amber-200 bg-gradient-to-r from-amber-50 to-orange-50">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-800">Profile Information</h2>
          </div>

          <div class="p-6">
            <form #formulaire="ngForm" (ngSubmit)="saveProfil(formulaire)" novalidate>

              <!-- First Name -->
              <div class="mb-4">
                <label class="block text-sm font-semibold text-gray-700 mb-2">First Name</label>
                <input
                  type="text"
                  name="first_name"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all"
                  [(ngModel)]="firstName"
                  #firstNameInput="ngModel"
                  placeholder="Enter your first name"
                  required />
                @if (firstNameInput.touched && firstNameInput.invalid) {
                  <div class="text-red-600 text-sm mt-1 flex items-center gap-1">
                    <span>First name is required</span>
                  </div>
                }
              </div>

              <!-- Last Name -->
              <div class="mb-4">
                <label class="block text-sm font-semibold text-gray-700 mb-2">Last Name</label>
                <input
                  type="text"
                  name="last_name"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all"
                  [(ngModel)]="lastName"
                  #lastNameInput="ngModel"
                  placeholder="Enter your last name"
                  required />
                @if (lastNameInput.touched && lastNameInput.invalid) {
                  <div class="text-red-600 text-sm mt-1 flex items-center gap-1">
                    <span>Last name is required</span>
                  </div>
                }
              </div>

              <!-- Email -->
              <div class="mb-4">
                <label class="block text-sm font-semibold text-gray-700 mb-2">Email</label>
                <input
                  type="email"
                  name="email"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all"
                  [(ngModel)]="email"
                  #emailInput="ngModel"
                  placeholder="Enter your email"
                  required
                  email />
                @if (emailInput.touched && emailInput.invalid) {
                  <div class="text-red-600 text-sm mt-1 flex items-center gap-1">
                    <span>Enter a valid email</span>
                  </div>
                }
              </div>

              <!-- Error / Success -->
              @if (error()) {
                <div class="mb-4 p-4 rounded-lg bg-red-100 border border-red-400 text-red-700">
                  {{ error() }}
                </div>
              }

              @if (success()) {
                <div class="mb-4 p-4 rounded-lg bg-green-100 border border-green-400 text-green-700">
                  {{ success() }}
                </div>
              }

              <button
                type="submit"
                class="w-full px-6 py-3 rounded-lg bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                [disabled]="loading()">
                @if (loading()) {
                  <span>Updating...</span>
                } @else {
                  <span>Save Changes</span>
                }
              </button>
            </form>

            <!-- CHANGE PASSWORD FORM -->
            <hr class="my-6 border-gray-200" />
            <div class="mt-6">
              <div class="px-4 sm:px-6 py-3 border-b border-amber-200 bg-gradient-to-r from-amber-50 to-orange-50 -mx-6 mb-4">
                <h3 class="text-lg sm:text-xl font-bold text-gray-800">Change Password</h3>
              </div>

              <form #passwordForm="ngForm" (ngSubmit)="changePassword(passwordForm)" novalidate>
                <div class="mb-4">
                  <label class="block text-sm font-semibold text-gray-700 mb-2">Current Password</label>
                  <input
                    type="password"
                    name="currentPassword"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all"
                    [(ngModel)]="passwordModel.oldPassword"
                    #currentPasswordInput="ngModel"
                    required
                    placeholder="Enter your current password" />
                  @if (currentPasswordInput.touched && currentPasswordInput.invalid) {
                    <div class="text-red-600 text-sm mt-1 flex items-center gap-1">
                      <span>Current password is required</span>
                    </div>
                  }
                </div>

                <div class="mb-4">
                  <label class="block text-sm font-semibold text-gray-700 mb-2">New Password</label>
                  <input
                    type="password"
                    name="newPassword"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all"
                    [(ngModel)]="passwordModel.newPassword"
                    #newPasswordInput="ngModel"
                    required
                    minlength="6"
                    placeholder="Enter new password (min. 6 characters)" />
                  @if (newPasswordInput.touched && newPasswordInput.invalid) {
                    <div class="text-red-600 text-sm mt-1 flex items-center gap-1">
                      @if (newPasswordInput.errors?.['required']) {
                        <span>New password is required</span>
                      }
                      @else if (newPasswordInput.errors?.['minlength']) {
                        <span>Password must be at least 6 characters</span>
                      }
                    </div>
                  }
                </div>

                <div class="mb-4">
                  <label class="block text-sm font-semibold text-gray-700 mb-2">Confirm New Password</label>
                  <input
                    type="password"
                    name="confirmPassword"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-all"
                    [(ngModel)]="passwordModel.confirmPassword"
                    #confirmPasswordInput="ngModel"
                    required
                    placeholder="Confirm your new password" />
                  @if (confirmPasswordInput.touched && confirmPasswordInput.invalid) {
                    <div class="text-red-600 text-sm mt-1 flex items-center gap-1">
                      <span>Please confirm your new password</span>
                    </div>
                  }
                  @if (confirmPasswordInput.touched && passwordModel.newPassword !== passwordModel.confirmPassword && passwordModel.confirmPassword) {
                    <div class="text-red-600 text-sm mt-1 flex items-center gap-1">
                      <span>Passwords do not match</span>
                    </div>
                  }
                </div>

                <button
                  type="submit"
                  class="w-full px-6 py-3 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                  [disabled]="passwordForm.invalid || loading() || (passwordModel.newPassword !== passwordModel.confirmPassword)">
                  @if (loading()) {
                    <span>Changing Password...</span>
                  } @else {
                    <span>Change Password</span>
                  }
                </button>
              </form>

              <!-- Success Message -->
              @if (passwordChangeSuccess()) {
                <div class="success-banner">
                  <svg class="success-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <div>
                    <h3>Password Changed Successfully!</h3>
                    <p>Your password has been updated securely.</p>
                  </div>
                </div>
              }
            </div>
          </div>

          <!--  DANGER ZONE: Only show for regular users -->
          @if (!isAdmin()) {
            <div class="danger-zone">
              <p class="danger-warning">
                Once you delete your account, there is no going back. This action cannot be undone.
              </p>
              <button type="button" class="delete-account-btn" (click)="openDeleteConfirmation()">
                Delete Account
              </button>
            </div>
          }
        </div>
      </div>

      <!-- ✅ Delete Confirmation Modal -->
      @if (showDeleteConfirmation()) {
        <div class="modal-overlay" (click)="closeDeleteConfirmation()">
          <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
              <h2>⚠️ Delete Account</h2>
              <button class="close-btn" (click)="closeDeleteConfirmation()">&times;</button>
            </div>

            <div class="modal-body">
              <p class="warning-text">
                <strong>This action is permanent and cannot be undone.</strong>
              </p>
              <p>All your data including:</p>
              <ul>
                <li>Profile information</li>
                <li>Order history</li>
                <li>Saved preferences</li>
              </ul>
              <p>will be permanently deleted.</p>

              <div class="confirmation-input">
                <label for="deleteConfirm">
                  Type <strong>DELETE</strong> to confirm:
                </label>
                <input
                  type="text"
                  id="deleteConfirm"
                  [(ngModel)]="deleteConfirmationText"
                  placeholder="Type DELETE"
                  autocomplete="off">
              </div>
            </div>

            <div class="modal-footer">
              <button
                type="button"
                class="btn-cancel"
                (click)="closeDeleteConfirmation()">
                Cancel
              </button>
              <button
                type="button"
                class="btn-delete"
                [disabled]="deleteConfirmationText !== 'DELETE' || loading()"
                (click)="confirmDeleteAccount()">
                {{ loading() ? 'Deleting...' : 'Delete My Account' }}
              </button>
            </div>
          </div>
        </div>
      }

      <!--  ORDER HISTORY: Only show for regular users -->
      @if (!isAdmin()) {
        <div class="lg:col-span-1">
          <div class="bg-white rounded-lg shadow-md overflow-hidden sticky top-20">
            <div class="px-4 sm:px-6 py-4 border-b border-amber-200 bg-gradient-to-r from-amber-50 to-orange-50">
              <h2 class="text-xl sm:text-2xl font-bold text-gray-800">Order History</h2>
            </div>

            <div class="p-4 sm:p-6">
              @if (!orders() || orders()!.length === 0) {
                <div class="text-center py-8">
                  <div class="text-gray-400 mb-3">
                    <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                    </svg>
                  </div>
                  <p class="text-gray-600 font-medium">You have no orders yet.</p>
                </div>
              }
              @else {
                <div class="space-y-4">
                  @for (order of orders(); track order.id) {
                    <div class="order-card">
                      <div class="order-header">
                        <div>
                          <div class="order-id">Order #{{ order.id }}</div>
                          <div class="order-date">{{ order.createdAt | date:'medium' }}</div>
                        </div>
                        <span class="order-status">{{ order.status }}</span>
                      </div>
                      <div class="order-footer">
                        <span class="order-total">${{ order.totalPrice }}</span>
                      </div>
                    </div>
                  }
                </div>
              }
            </div>
          </div>
        </div>
      }

    </div>
  </div>
</div>
